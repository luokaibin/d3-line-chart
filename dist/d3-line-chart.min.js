var D3LineChart=function(t,i){"use strict";function e(t){var i=Object.create(null);return t&&Object.keys(t).forEach((function(e){if("default"!==e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(i,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})}})),i.default=t,Object.freeze(i)}var n=e(i);const s={lineColor:"#3498db",showShadow:!0,gridColor:"#e0e0e0",enableAnimation:!0,animationDuration:1e3,axisTextColor:"#333333",axisTextSize:"12px",curveType:"linear",tickCount:5,margin:{top:20,right:30,bottom:40,left:50}};function a(t,i,e){if(i.x===e.x)return Math.abs(t.x-i.x);const n=(e.y-i.y)/(e.x-i.x),s=-n,a=-(i.y-n*i.x);return Math.abs(s*t.x+1*t.y+a)/Math.sqrt(s*s+1)}function h(t,i){if(t.length<70)return[...t];let e=0,n=0;const s=t[0],r=t[t.length-1];for(let i=1;i<t.length-1;i++){const h=a(t[i],s,r);h>e&&(e=h,n=i)}if(e>i){const e=h(t.slice(0,n+1),i),s=h(t.slice(n),i);return[...e.slice(0,-1),...s]}return[s,r]}function r(t){if(!t||0===t.length)return{};const i={},e=(t,i)=>Math.abs(t)>=1e6?(t/1e6).toFixed(i)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(i)+"K":i>0?t.toFixed(i):t.toString(),n=i=>{const n=t.map((t=>e(t,i)));return new Set(n).size===n.length};let s=0;for(;!n(s)&&s<6;)s++;return t.forEach((t=>{i[t]=e(t,s)})),i}class o extends HTMLElement{constructor(){super(),this.ctx=null,this.data=[],this.keyPoints=[],this.keyTicks=[],this.config={...s},this.width=0,this.height=0,this.margin={top:20,right:30,bottom:40,left:50},this.xScale=n.scaleLinear(),this.yScale=n.scaleLinear(),this.animationProgress=0,this.animationId=null,this.shadow=this.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent="\n      :host {\n        display: block;\n        width: 100%;\n        height: 100%;\n      }\n      \n      .container {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n      }\n      \n      canvas {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n      }\n      \n      svg {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n      }\n      \n      .key-point {\n        position: absolute;\n        transform: translateX(-50%);\n        z-index: 10;\n        pointer-events: auto;\n      }\n    ",this.container=document.createElement("div"),this.container.className="container",this.canvasContainer=document.createElement("canvas"),this.ctx=this.canvasContainer.getContext("2d"),this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.appendChild(this.canvasContainer),this.container.appendChild(this.svgContainer),this.shadow.appendChild(t),this.shadow.appendChild(this.container),this.debouncedResize=function(t,i){let e=null;return function(...n){null!==e&&window.clearTimeout(e),e=window.setTimeout((()=>{t.apply(this,n),e=null}),i)}}(this.resize.bind(this),200),this.setupResizeObserver()}connectedCallback(){this.resize()}disconnectedCallback(){null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}setConfig(t){return this.config={...this.config,...t},t.margin&&(this.margin={top:void 0!==t.margin.top?t.margin.top:this.margin.top,right:void 0!==t.margin.right?t.margin.right:this.margin.right,bottom:void 0!==t.margin.bottom?t.margin.bottom:this.margin.bottom,left:void 0!==t.margin.left?t.margin.left:this.margin.left}),this.render(),this}getMargin(){return{...this.margin}}setEnableAnimation(t,i){return this.config.enableAnimation=t,void 0!==i&&(this.config.animationDuration=i),this}setData(t){return this.data=[...t],this.animationProgress=0,this.updateScales(),this.render(),this}setKeyPoints(t){return this.keyPoints=[...t],this.render(),this}setKeyTicks(t){return this.keyTicks=[...t],this.render(),this}getConfig(){return{...this.config}}getEnableAnimation(){return!!this.config.enableAnimation}getAnimationDuration(){return this.config.animationDuration||s.animationDuration}getGridColor(){return this.config.gridColor||s.gridColor}getLineColor(){return this.config.lineColor||s.lineColor}getShowShadow(){return void 0!==this.config.showShadow?this.config.showShadow:s.showShadow}getAxisTextColor(){return this.config.axisTextColor||s.axisTextColor}getAxisTextSize(){return this.config.axisTextSize||s.axisTextSize}getData(){return[...this.data]}getKeyPoints(){return[...this.keyPoints]}getKeyTicks(){return[...this.keyTicks]}getCurveType(){return this.config.curveType||s.curveType}setupResizeObserver(){new ResizeObserver((()=>{this.debouncedResize()})).observe(this),this.resize()}resize(){const t=this.getBoundingClientRect();this.width=t.width,this.height=t.height,this.canvasContainer.width=this.width*window.devicePixelRatio,this.canvasContainer.height=this.height*window.devicePixelRatio,this.canvasContainer.style.width=`${this.width}px`,this.canvasContainer.style.height=`${this.height}px`,this.ctx&&this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.updateScales(),this.render()}updateScales(){if(0===this.data.length)return;const t=n.extent(this.data,(t=>t.x)),i=n.extent(this.data,(t=>t.y));this.xScale=n.scaleLinear().domain(t).range([this.margin.left,this.width-this.margin.right]),this.yScale=n.scaleLinear().domain(i).range([this.height-this.margin.bottom,this.margin.top])}render(){if(!this.ctx||0===this.data.length)return;for(this.ctx.clearRect(0,0,this.width,this.height);this.svgContainer.firstChild;)this.svgContainer.removeChild(this.svgContainer.firstChild);this.shadow.querySelectorAll(".key-point").forEach((t=>t.remove())),this.extendYScaleDomain(),this.drawGridAndAxis(),this.config.enableAnimation?this.startAnimation():(this.drawLine(1),this.renderKeyPoints())}extendYScaleDomain(){let t=this.yScale.ticks(this.getTickCount());if(t.length>=2){t.sort(((t,i)=>t-i));const i=n.min(this.data,(t=>t.y))||0;if(t[0]>i){const i=t[1]-t[0],e=t[0]-i,n=this.yScale.domain();this.yScale.domain([e,n[1]])}}}getTickCount(){return this.config.tickCount||s.tickCount}drawGridAndAxis(){n.select(this.svgContainer).selectAll("*").remove();const t=n.select(this.svgContainer);let i=this.yScale.ticks(this.getTickCount());const e=r(i),s=t.append("text").attr("class","temp-text").attr("font-size",this.getAxisTextSize()).style("visibility","hidden"),a=Object.values(e),h=Math.max(...a.map((t=>(s.text(t),s.node()?.getBBox().width||0)))),o=this.margin.left+h+10;s.remove(),t.selectAll(".grid-line-y").data(i).enter().append("line").attr("class","grid-line-y").attr("x1",o).attr("x2",this.width-this.margin.right).attr("y1",(t=>this.yScale(t))).attr("y2",(t=>this.yScale(t))).attr("stroke",this.getGridColor()).attr("stroke-dasharray","3,3").attr("stroke-width",1),t.selectAll(".y-axis-label").data(i).enter().append("text").attr("class","y-axis-label").attr("x",o-10).attr("y",(t=>this.yScale(t))).attr("dy","0.32em").attr("text-anchor","end").attr("fill",this.getAxisTextColor()).attr("font-size",this.getAxisTextSize()).text((t=>e[t])),t.append("line").attr("class","x-axis").attr("x1",o).attr("x2",this.width-this.margin.right).attr("y1",this.yScale(i[0])).attr("y2",this.yScale(i[0])).attr("stroke",this.getGridColor()).attr("stroke-dasharray","3,3").attr("stroke-width",1),this.keyTicks.length>0&&t.selectAll(".key-tick").data(this.keyTicks).enter().append("text").attr("class","key-tick").attr("x",(t=>this.xScale(t.x))).attr("y",this.yScale(i[0])+20).attr("text-anchor","middle").attr("fill",this.getAxisTextColor()).attr("font-size",this.getAxisTextSize()).text((t=>t.label))}drawLine(t){this.ctx&&0!==this.data.length&&("curve"===this.getCurveType()?this.drawCurveLine(t):this.drawLinearLine(t))}drawLinearLine(t){if(!this.ctx||0===this.data.length)return;const i=n.select(this.svgContainer).select(".x-axis");let e=this.margin.left;i.attr("x1")&&(e=parseFloat(i.attr("x1")));const s=h(this.data,.6),a=Math.floor(s.length*t),r=s.slice(0,a);if(r.length<2)return;const o=n.scaleLinear().domain([n.min(this.data,(t=>t.x))||0,n.max(this.data,(t=>t.x))||0]).range([e,this.width-this.margin.right]);this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(o(r[0].x),this.yScale(r[0].y));for(let t=1;t<r.length;t++)this.ctx.lineTo(o(r[t].x),this.yScale(r[t].y));if(this.ctx.strokeStyle=this.getLineColor(),this.ctx.lineWidth=2,this.ctx.stroke(),this.getShowShadow()){this.ctx.lineTo(o(r[r.length-1].x),this.height-this.margin.bottom),this.ctx.lineTo(o(r[0].x),this.height-this.margin.bottom),this.ctx.closePath();const t=this.ctx.createLinearGradient(0,this.margin.top,0,this.height-this.margin.bottom),i=this.getLineColor();t.addColorStop(0,`${i}80`),t.addColorStop(1,`${i}00`),this.ctx.fillStyle=t,this.ctx.fill()}this.ctx.restore()}drawCurveLine(t){if(!this.ctx||0===this.data.length)return;const i=n.select(this.svgContainer).select(".x-axis");let e=this.margin.left;i.attr("x1")&&(e=parseFloat(i.attr("x1")));const s=h(this.data,.6),a=Math.floor(s.length*t),r=s.slice(0,a);if(r.length<2)return;const o=n.scaleLinear().domain([n.min(this.data,(t=>t.x))||0,n.max(this.data,(t=>t.x))||0]).range([e,this.width-this.margin.right]),l=n.line().x((t=>o(t.x))).y((t=>this.yScale(t.y))).curve(n.curveCatmullRom.alpha(.5))(r);if(!l)return;this.ctx.save(),this.ctx.beginPath();const c=new Path2D(l);if(this.ctx.strokeStyle=this.getLineColor(),this.ctx.lineWidth=2,this.ctx.stroke(c),this.getShowShadow()){this.ctx.beginPath();const t=new Path2D(l);t.lineTo(o(r[r.length-1].x),this.height-this.margin.bottom),t.lineTo(o(r[0].x),this.height-this.margin.bottom),t.closePath();const i=this.ctx.createLinearGradient(0,this.margin.top,0,this.height-this.margin.bottom),e=this.getLineColor();i.addColorStop(0,`${e}80`),i.addColorStop(1,`${e}00`),this.ctx.fillStyle=i,this.ctx.fill(t)}this.ctx.restore()}renderKeyPoints(){this.keyPoints.filter((t=>{const i=this.xScale(t.x),e=this.yScale(t.y);return i>=this.margin.left&&i<=this.width-this.margin.right&&e>=this.margin.top&&e<=this.height-this.margin.bottom})).forEach((t=>{const i=document.createElement("div");i.className="key-point";const e=this.height-this.margin.bottom,n=this.yScale(t.y),s=document.createElement("div");s.className="key-point",s.innerHTML=t.render,s.style.position="absolute",s.style.visibility="hidden",this.container.appendChild(s);const a=s.offsetHeight,h=s.offsetWidth;this.container.removeChild(s);const o=this.xScale(t.x),l=this.yScale.ticks(this.getTickCount()),c=document.createElement("span");c.style.visibility="hidden",c.style.position="absolute",c.style.fontSize=this.getAxisTextSize(),this.container.appendChild(c);const d=r(l),g=Object.values(d),m=Math.max(...g.map((t=>(c.textContent=t,c.offsetWidth)))),x=this.margin.left+m+10;this.container.removeChild(c);const u=o-h/2<x;let f=o;o+h/2>this.width-this.margin.right?f=this.width-this.margin.right-h/2:u&&(f=x+h/2),i.style.left=`${f}px`;let y;e-n<2*a?(y=n-a,y<this.margin.top&&(y=this.margin.top)):y=n-20,i.style.top=`${y}px`,i.innerHTML=t.render,this.container.appendChild(i)}))}startAnimation(){null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.animationProgress=0;const t=performance.now(),i=this.getAnimationDuration(),e=n=>{const s=n-t;this.animationProgress=Math.min(s/i,1),this.ctx&&this.ctx.clearRect(0,0,this.width,this.height),this.drawLine(this.animationProgress),this.animationProgress<1?this.animationId=requestAnimationFrame(e):(this.renderKeyPoints(),this.animationId=null)};this.animationId=requestAnimationFrame(e)}}return customElements.define("d3-line-chart",o),t.D3LineChart=o,t}({},d3);
//# sourceMappingURL=d3-line-chart.min.js.map
