var D3LineChart=function(t,i){"use strict";function e(t){var i=Object.create(null);return t&&Object.keys(t).forEach((function(e){if("default"!==e){var n=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(i,e,n.get?n:{enumerable:!0,get:function(){return t[e]}})}})),i.default=t,Object.freeze(i)}var n=e(i);const s={lineColor:"#3498db",showShadow:!0,gridColor:"#e0e0e0",enableAnimation:!0,animationDuration:1e3,axisTextColor:"#333333",axisTextSize:"12px",gridNumberDecimal:0,margin:{top:20,right:30,bottom:40,left:50}};function a(t,i,e){if(i.x===e.x)return Math.abs(t.x-i.x);const n=(e.y-i.y)/(e.x-i.x),s=-n,a=-(i.y-n*i.x);return Math.abs(s*t.x+1*t.y+a)/Math.sqrt(s*s+1)}function r(t,i){if(t.length<=2)return[...t];let e=0,n=0;const s=t[0],h=t[t.length-1];for(let i=1;i<t.length-1;i++){const r=a(t[i],s,h);r>e&&(e=r,n=i)}if(e>i){const e=r(t.slice(0,n+1),i),s=r(t.slice(n),i);return[...e.slice(0,-1),...s]}return[s,h]}class h extends HTMLElement{constructor(){super(),this.ctx=null,this.data=[],this.keyPoints=[],this.keyTicks=[],this.config={...s},this.width=0,this.height=0,this.margin={top:20,right:30,bottom:40,left:50},this.xScale=n.scaleLinear(),this.yScale=n.scaleLinear(),this.animationProgress=0,this.animationId=null,this.shadow=this.attachShadow({mode:"open"});const t=document.createElement("style");t.textContent="\n      :host {\n        display: block;\n        width: 100%;\n        height: 100%;\n      }\n      \n      .container {\n        position: relative;\n        width: 100%;\n        height: 100%;\n        overflow: hidden;\n      }\n      \n      canvas {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n      }\n      \n      svg {\n        position: absolute;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        pointer-events: none;\n      }\n      \n      .key-point {\n        position: absolute;\n        transform: translate(-50%, -50%);\n        z-index: 10;\n        pointer-events: auto;\n      }\n    ",this.container=document.createElement("div"),this.container.className="container",this.canvasContainer=document.createElement("canvas"),this.ctx=this.canvasContainer.getContext("2d"),this.svgContainer=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.container.appendChild(this.canvasContainer),this.container.appendChild(this.svgContainer),this.shadow.appendChild(t),this.shadow.appendChild(this.container),this.debouncedResize=function(t,i){let e=null;return function(...n){null!==e&&window.clearTimeout(e),e=window.setTimeout((()=>{t.apply(this,n),e=null}),i)}}(this.resize.bind(this),200),this.setupResizeObserver()}connectedCallback(){this.resize()}disconnectedCallback(){null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null)}setConfig(t){return this.config={...this.config,...t},t.margin&&(this.margin={top:void 0!==t.margin.top?t.margin.top:this.margin.top,right:void 0!==t.margin.right?t.margin.right:this.margin.right,bottom:void 0!==t.margin.bottom?t.margin.bottom:this.margin.bottom,left:void 0!==t.margin.left?t.margin.left:this.margin.left}),this.render(),this}getMargin(){return{...this.margin}}setEnableAnimation(t,i){return this.config.enableAnimation=t,void 0!==i&&(this.config.animationDuration=i),this}setData(t){return this.data=[...t],this.animationProgress=0,this.updateScales(),this.render(),this}setKeyPoints(t){return this.keyPoints=[...t],this.render(),this}setKeyTicks(t){return this.keyTicks=[...t],this.render(),this}getConfig(){return{...this.config}}getEnableAnimation(){return!!this.config.enableAnimation}getAnimationDuration(){return this.config.animationDuration||s.animationDuration}getGridColor(){return this.config.gridColor||s.gridColor}getLineColor(){return this.config.lineColor||s.lineColor}getShowShadow(){return void 0!==this.config.showShadow?this.config.showShadow:s.showShadow}getAxisTextColor(){return this.config.axisTextColor||s.axisTextColor}getAxisTextSize(){return this.config.axisTextSize||s.axisTextSize}getData(){return[...this.data]}getKeyPoints(){return[...this.keyPoints]}getKeyTicks(){return[...this.keyTicks]}setupResizeObserver(){new ResizeObserver((()=>{this.debouncedResize()})).observe(this),this.resize()}resize(){const t=this.getBoundingClientRect();this.width=t.width,this.height=t.height,this.canvasContainer.width=this.width*window.devicePixelRatio,this.canvasContainer.height=this.height*window.devicePixelRatio,this.canvasContainer.style.width=`${this.width}px`,this.canvasContainer.style.height=`${this.height}px`,this.ctx&&this.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),this.updateScales(),this.render()}updateScales(){if(0===this.data.length)return;const t=n.extent(this.data,(t=>t.x)),i=n.extent(this.data,(t=>t.y));this.xScale=n.scaleLinear().domain(t).range([this.margin.left,this.width-this.margin.right]),this.yScale=n.scaleLinear().domain(i).range([this.height-this.margin.bottom,this.margin.top])}render(){if(!this.ctx||0===this.data.length)return;for(this.ctx.clearRect(0,0,this.width,this.height);this.svgContainer.firstChild;)this.svgContainer.removeChild(this.svgContainer.firstChild);this.shadow.querySelectorAll(".key-point").forEach((t=>t.remove())),this.drawGridAndAxis(),this.config.enableAnimation?this.startAnimation():(this.drawLine(1),this.renderKeyPoints())}drawGridAndAxis(){const t=n.select(this.svgContainer),i=this.yScale.ticks(5);t.selectAll(".grid-line-y").data(i).enter().append("line").attr("class","grid-line-y").attr("x1",this.margin.left).attr("x2",this.width-this.margin.right).attr("y1",(t=>this.yScale(t))).attr("y2",(t=>this.yScale(t))).attr("stroke",this.getGridColor()).attr("stroke-dasharray","3,3").attr("stroke-width",1),t.selectAll(".y-axis-label").data(i).enter().append("text").attr("class","y-axis-label").attr("x",this.margin.left-10).attr("y",(t=>this.yScale(t))).attr("dy","0.32em").attr("text-anchor","end").attr("fill",this.getAxisTextColor()).attr("font-size",this.getAxisTextSize()).text((t=>function(t,i=0){return Math.abs(t)>=1e6?(t/1e6).toFixed(i)+"M":Math.abs(t)>=1e3?(t/1e3).toFixed(i)+"K":t.toFixed(i)}(t,this.config.gridNumberDecimal||0))),t.append("line").attr("class","x-axis").attr("x1",this.margin.left).attr("x2",this.width-this.margin.right).attr("y1",this.height-this.margin.bottom).attr("y2",this.height-this.margin.bottom).attr("stroke",this.getGridColor()).attr("stroke-dasharray","3,3").attr("stroke-width",1),this.keyTicks.length>0&&t.selectAll(".key-tick").data(this.keyTicks).enter().append("text").attr("class","key-tick").attr("x",(t=>this.xScale(t.x))).attr("y",this.height-this.margin.bottom+20).attr("text-anchor","middle").attr("fill",this.getAxisTextColor()).attr("font-size",this.getAxisTextSize()).text((t=>t.label))}drawLine(t){if(!this.ctx||0===this.data.length)return;const i=r(this.data,.5),e=Math.floor(i.length*t),n=i.slice(0,e);if(!(n.length<2)){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(this.xScale(n[0].x),this.yScale(n[0].y));for(let t=1;t<n.length;t++)this.ctx.lineTo(this.xScale(n[t].x),this.yScale(n[t].y));if(this.ctx.strokeStyle=this.getLineColor(),this.ctx.lineWidth=2,this.ctx.stroke(),this.getShowShadow()){this.ctx.lineTo(this.xScale(n[n.length-1].x),this.height-this.margin.bottom),this.ctx.lineTo(this.xScale(n[0].x),this.height-this.margin.bottom),this.ctx.closePath();const t=this.ctx.createLinearGradient(0,this.margin.top,0,this.height-this.margin.bottom),i=this.getLineColor();t.addColorStop(0,`${i}80`),t.addColorStop(1,`${i}00`),this.ctx.fillStyle=t,this.ctx.fill()}this.ctx.restore()}}renderKeyPoints(){this.keyPoints.filter((t=>{const i=this.xScale(t.x),e=this.yScale(t.y);return i>=this.margin.left&&i<=this.width-this.margin.right&&e>=this.margin.top&&e<=this.height-this.margin.bottom})).forEach((t=>{const i=document.createElement("div");i.className="key-point",i.style.left=`${this.xScale(t.x)}px`,i.style.top=`${this.yScale(t.y)}px`,i.innerHTML=t.render,this.container.appendChild(i)}))}startAnimation(){null!==this.animationId&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.animationProgress=0;const t=performance.now(),i=this.getAnimationDuration(),e=n=>{const s=n-t;this.animationProgress=Math.min(s/i,1),this.ctx&&this.ctx.clearRect(0,0,this.width,this.height),this.drawLine(this.animationProgress),this.animationProgress<1?this.animationId=requestAnimationFrame(e):(this.renderKeyPoints(),this.animationId=null)};this.animationId=requestAnimationFrame(e)}}return customElements.define("d3-line-chart",h),t.D3LineChart=h,t}({},d3);
//# sourceMappingURL=d3-line-chart.min.js.map
